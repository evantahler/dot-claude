# Key Learnings

## Stale Server Process Issue (2026-02-04)

**Problem:** Tests were failing because old server processes were still running, serving cached/stale code. Changes to TypeScript files weren't being reflected when hitting HTTP endpoints.

**Symptoms:**
- Code changes don't appear in HTTP responses
- Console.log statements added to actions don't show output
- Direct action invocation works, but HTTP requests return old behavior
- Tests fail unexpectedly after code changes

**Root Cause:** Multiple `bun actionhero.ts start` processes left running from previous dev sessions (days old), binding to the same port and serving outdated code.

**Solution:** Kill all existing actionhero processes before testing:
```bash
ps aux | grep "bun actionhero" | grep -v grep
kill -9 <PIDs>
```

**Prevention:** Always check for and kill stale processes when code changes aren't being reflected.

## Debugging Strategy for Missing API State

When debugging missing data in api.* properties:
1. First verify the initializer runs and stores data (check logs)
2. Test direct action invocation vs HTTP endpoint separately
3. If direct works but HTTP doesn't, suspect process/caching issues
4. Add temporary debug fields to responses (not just console.log)
5. Check for running processes with `ps aux`

## Swagger Implementation

The swagger initializer (priority 150) runs after actions (priority 100) and uses ts-morph to:
- Parse action class files at runtime
- Extract TypeScript return types from `run()` methods
- Convert types to JSON Schema format
- Store schemas in `api.swagger.responseSchemas` keyed by action name

The swagger action then references these schemas to generate OpenAPI documentation with proper `$ref` links to component schemas.

## Documentation Site (2026-02-07)

A VitePress docs site lives in `docs/`. When modifying backend code, remember to update docs:
- **Auto-generated**: `docs/reference/` pages pull from JSON generated by `docs/scripts/generate-docs-data.ts` (run `bun run generate` in docs/)
- **Manual**: `docs/guide/*.md` pages need hand updates when actions, initializers, config, channels, middleware, or testing patterns change
- **README inclusion**: The landing page `docs/index.md` includes `README.md` via `<!--@include: ../README.md-->`, so README changes auto-propagate
- Build: `bun docs:build` from root, or `cd docs && bun run build`
- The `vitepress-plugin-llms` generates `llms.txt` and `llms-full.txt` at build time
